<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Photo Booth</title>
  <link rel="icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='.9em' font-size='90'>ðŸ“¸</text></svg>">
  <link href="https://fonts.googleapis.com/css2?family=DM+Sans:ital,opsz,wght@0,9..40,300;0,9..40,400;0,9..40,500;0,9..40,600;0,9..40,700;1,9..40,400&family=Playfair+Display:wght@600;700&display=swap" rel="stylesheet">
  <link href="https://fonts.googleapis.com/icon?family=Material+Icons+Round" rel="stylesheet">
  <link rel="stylesheet" href="style.css">

  <!-- reCAPTCHA v3 -->
  <script src="https://www.google.com/recaptcha/api.js?render=6Ld0RWgsAAAAABRdIcHVQcVkgAswfd_wb4mluzfY"></script>

  <!-- EmailJS SDK -->
  <script src="https://cdn.jsdelivr.net/npm/@emailjs/browser@4/dist/email.min.js"></script>

  <!-- FingerprintJS for device identification -->
  <script src="https://cdn.jsdelivr.net/npm/@fingerprintjs/fingerprintjs@4/dist/fp.min.js"></script>
</head>
<body>

  <!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
       AUTH SCREEN (shown when not logged in)
       â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
  <div id="authScreen" class="auth-screen">
    <div class="auth-container">
      <div class="auth-logo">
        <span class="material-icons-round">photo_camera</span>
      </div>
      <h1 class="auth-title">Photo Booth</h1>
      <p class="auth-subtitle">Sign in to start capturing memories</p>

      <!-- Auth Tabs -->
      <div class="auth-tabs">
        <button class="auth-tab active" onclick="switchAuthTab('login')">Sign In</button>
        <button class="auth-tab" onclick="switchAuthTab('signup')">Sign Up</button>
      </div>

      <!-- Login Form -->
      <div id="loginForm" class="auth-form">
        <div class="form-group">
          <label>Email</label>
          <input type="email" id="loginEmail" placeholder="you@email.com" autocomplete="email">
        </div>
        <div class="form-group">
          <label>Password</label>
          <input type="password" id="loginPassword" placeholder="Your password" autocomplete="current-password">
        </div>
        <button class="btn btn-primary btn-full" onclick="handleLogin()">
          <span class="material-icons-round">login</span> Sign In
        </button>
      </div>

      <!-- Signup Form -->
      <div id="signupForm" class="auth-form" style="display:none;">
        <div class="form-group">
          <label>Display Name</label>
          <input type="text" id="signupName" placeholder="Your name" maxlength="40" autocomplete="name">
        </div>
        <div class="form-group">
          <label>Email</label>
          <input type="email" id="signupEmail" placeholder="you@email.com" autocomplete="email">
        </div>
        <div class="form-group">
          <label>Password</label>
          <input type="password" id="signupPassword" placeholder="At least 6 characters" autocomplete="new-password">
        </div>
        <div class="form-group">
          <label>Confirm Password</label>
          <input type="password" id="signupConfirm" placeholder="Confirm password" autocomplete="new-password">
        </div>
        <button class="btn btn-primary btn-full" onclick="handleSignup()">
          <span class="material-icons-round">person_add</span> Create Account
        </button>
      </div>

      <!-- Divider -->
      <div class="auth-divider">
        <span>or</span>
      </div>

      <!-- Google Sign-In -->
      <button class="btn btn-google btn-full" onclick="handleGoogleLogin()">
        <svg width="18" height="18" viewBox="0 0 48 48"><path fill="#EA4335" d="M24 9.5c3.54 0 6.71 1.22 9.21 3.6l6.85-6.85C35.9 2.38 30.47 0 24 0 14.62 0 6.51 5.38 2.56 13.22l7.98 6.19C12.43 13.72 17.74 9.5 24 9.5z"/><path fill="#4285F4" d="M46.98 24.55c0-1.57-.15-3.09-.38-4.55H24v9.02h12.94c-.58 2.96-2.26 5.48-4.78 7.18l7.73 6c4.51-4.18 7.09-10.36 7.09-17.65z"/><path fill="#FBBC05" d="M10.53 28.59c-.48-1.45-.76-2.99-.76-4.59s.27-3.14.76-4.59l-7.98-6.19C.92 16.46 0 20.12 0 24c0 3.88.92 7.54 2.56 10.78l7.97-6.19z"/><path fill="#34A853" d="M24 48c6.48 0 11.93-2.13 15.89-5.81l-7.73-6c-2.15 1.45-4.92 2.3-8.16 2.3-6.26 0-11.57-4.22-13.47-9.91l-7.98 6.19C6.51 42.62 14.62 48 24 48z"/></svg>
        Continue with Google
      </button>

      <!-- Auth Status -->
      <div class="auth-status" id="authStatus"></div>

      <!-- reCAPTCHA badge note -->
      <p class="recaptcha-note">Protected by reCAPTCHA v3</p>
    </div>
  </div>

  <!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
       MAIN APP (shown when logged in)
       â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
  <div id="appScreen" class="app-screen" style="display:none;">

    <!-- Header -->
    <header class="app-header">
      <div class="header-left">
        <span class="material-icons-round logo-icon">photo_camera</span>
        <h1>Photo Booth</h1>
      </div>
      <div class="header-right">
        <div class="user-info" id="userInfo">
          <span class="user-name" id="userName"></span>
          <img class="user-avatar" id="userAvatar" src="" alt="">
        </div>
        <button class="icon-btn" onclick="toggleSettings()" title="Settings">
          <span class="material-icons-round">tune</span>
        </button>
        <button class="icon-btn" onclick="handleLogout()" title="Sign Out">
          <span class="material-icons-round">logout</span>
        </button>
      </div>
    </header>

    <!-- Main Content -->
    <main class="main-content">
      <div class="booth-area">
        <!-- Camera -->
        <div class="camera-panel">
          <div class="camera-container" id="cameraContainer">
            <video id="video" autoplay playsinline muted></video>
            <div class="countdown-overlay" id="countdownOverlay">
              <span id="countdownNumber"></span>
            </div>
            <div class="flash-overlay" id="flashOverlay"></div>
            <div class="camera-off" id="cameraOff">
              <span class="material-icons-round">videocam_off</span>
              <p>Camera is off</p>
              <button class="btn btn-primary" onclick="startCamera()">
                <span class="material-icons-round">videocam</span> Start Camera
              </button>
            </div>
            <div class="shot-counter" id="shotCounter"></div>
          </div>
          <div class="camera-controls">
            <button class="ctrl-btn" onclick="flipCamera()" title="Flip Camera">
              <span class="material-icons-round">flip_camera_ios</span>
            </button>
            <button class="capture-btn" id="btnCapture" onclick="startCapture()" title="Take Photo">
              <span class="material-icons-round">camera</span>
            </button>
            <button class="ctrl-btn" onclick="cycleTimer()" title="Timer">
              <span class="material-icons-round">timer</span>
              <span class="timer-badge" id="timerBadge">OFF</span>
            </button>
          </div>
        </div>

        <!-- Live Preview -->
        <div class="preview-panel" id="previewPanel">
          <div class="preview-label">
            <span class="material-icons-round">preview</span> Live Preview
          </div>
          <div class="preview-strip-wrap">
            <canvas id="livePreviewCanvas"></canvas>
          </div>
          <div class="preview-actions" id="previewActions" style="display:none;">
            <button class="btn btn-sm btn-outline" onclick="resetBooth()">
              <span class="material-icons-round">replay</span> Reset
            </button>
            <button class="btn btn-sm btn-outline" onclick="downloadPhoto()">
              <span class="material-icons-round">download</span> Download
            </button>
            <button class="btn btn-sm btn-outline" onclick="printPhoto()">
              <span class="material-icons-round">print</span> Print
            </button>
            <button class="btn btn-sm btn-primary" onclick="openEmailModal()">
              <span class="material-icons-round">email</span> Email
            </button>
          </div>
          <div class="status-msg" id="statusMsg"></div>
        </div>
      </div>

      <!-- Layout Selector -->
      <section class="option-section">
        <h3><span class="material-icons-round">grid_view</span> Layout</h3>
        <div class="option-scroll" id="layoutGrid"></div>
      </section>

      <!-- Frame Selector -->
      <section class="option-section">
        <h3><span class="material-icons-round">filter_frames</span> Frame</h3>
        <div class="option-scroll" id="frameGrid"></div>
      </section>

      <!-- Filter Selector -->
      <section class="option-section">
        <h3><span class="material-icons-round">auto_awesome</span> Filter</h3>
        <div class="option-scroll" id="filterGrid"></div>
      </section>
    </main>
  </div>

  <!-- â•â•â• EMAIL MODAL â•â•â• -->
  <div class="modal-backdrop" id="emailModal">
    <div class="modal-content email-modal">
      <div class="modal-header">
        <h2>Send Photo via Email</h2>
        <button class="icon-btn" onclick="closeEmailModal()">
          <span class="material-icons-round">close</span>
        </button>
      </div>
      <div class="modal-body">
        <p class="modal-desc">Enter your email to receive this photo.</p>
        <div class="form-group">
          <label for="recipientName">Your Name</label>
          <input type="text" id="recipientName" placeholder="Juan Dela Cruz" maxlength="60">
        </div>
        <div class="form-group">
          <label for="recipientEmail">Your Email</label>
          <input type="email" id="recipientEmail" placeholder="juan@email.com">
        </div>
        <div class="form-actions">
          <button class="btn btn-outline" onclick="closeEmailModal()">Cancel</button>
          <button class="btn btn-primary" id="btnSendEmail" onclick="sendEmail()">
            <span class="material-icons-round">send</span> Send Photo
          </button>
        </div>
        <div class="email-status" id="emailStatus"></div>
      </div>
    </div>
  </div>

  <!-- â•â•â• SETTINGS MODAL â•â•â• -->
  <div class="modal-backdrop" id="settingsModal">
    <div class="modal-content settings-modal">
      <div class="modal-header">
        <h2>Settings</h2>
        <button class="icon-btn" onclick="toggleSettings()">
          <span class="material-icons-round">close</span>
        </button>
      </div>
      <div class="settings-body">
        <div class="setting-row">
          <label>Mirror Camera</label>
          <label class="switch"><input type="checkbox" id="settingMirror" checked onchange="updateSettings()"><span class="slider"></span></label>
        </div>
        <div class="setting-row">
          <label>Flash Effect</label>
          <label class="switch"><input type="checkbox" id="settingFlash" checked onchange="updateSettings()"><span class="slider"></span></label>
        </div>
        <div class="setting-row">
          <label>Shutter Sound</label>
          <label class="switch"><input type="checkbox" id="settingSound" checked onchange="updateSettings()"><span class="slider"></span></label>
        </div>
        <div class="setting-row">
          <label>Event Title</label>
          <input type="text" id="settingTitle" placeholder="e.g. John & Jane's Wedding" maxlength="50" onchange="updateSettings()">
        </div>
        <div class="setting-row">
          <label>Event Date</label>
          <input type="text" id="settingDate" placeholder="e.g. February 14, 2025" maxlength="30" onchange="updateSettings()">
        </div>
        <hr class="setting-divider">
        <h4 class="setting-section-title">EmailJS Configuration</h4>
        <p class="setting-hint">Get these from <a href="https://www.emailjs.com/" target="_blank">emailjs.com</a></p>
        <div class="setting-row">
          <label>Public Key</label>
          <input type="text" id="settingEmailPublicKey" placeholder="Your public key" onchange="updateSettings()">
        </div>
        <div class="setting-row">
          <label>Service ID</label>
          <input type="text" id="settingEmailServiceId" placeholder="service_xxxxxxx" onchange="updateSettings()">
        </div>
        <div class="setting-row">
          <label>Template ID</label>
          <input type="text" id="settingEmailTemplateId" placeholder="template_xxxxxxx" onchange="updateSettings()">
        </div>
      </div>
    </div>
  </div>

  <!-- Hidden print iframe -->
  <iframe id="printFrame" style="position:absolute;left:-9999px;top:-9999px;width:0;height:0;border:none;"></iframe>

  <!-- Firebase SDKs (modular via compat for simplicity) -->
  <script src="https://www.gstatic.com/firebasejs/10.12.0/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.12.0/firebase-auth-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.12.0/firebase-firestore-compat.js"></script>

  <script src="auth.js"></script>
  <script src="script.js"></script>
</body>
</html>
